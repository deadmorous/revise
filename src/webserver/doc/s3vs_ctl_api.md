Введение
========

В процессе работы с сервером визуализации (Visualization Server, далее VS)
одна из типичных задач - получение с сервера параметров визуализации и их модификация.
Параметры образуют деревья; можно сказать, что они идеально описываются в формате JSON.

Сейчас эти параметры находятся внутри `VsControllerInput`; но в принципе могут быть и другие
"параметродержатели".

Предлагается реализовать следующий небольшой набор запросов,
позволяющий эффективно решать эти задачи.

API для чтения/записи параметров
================================

Общий вид запроса чтения/записи параметров
------------------------------------------

```
/<prefix>/<command>?<parameters>
```

где

- `<prefix>` определяет набор параметров, например, `vs/input` или `vs/options`;
- `<command>` - одна из команд, описанных ниже;
- `<parameters>` - параметры команды.

Команды
-------

- `names` - чтение имён всех узлов, дочерних по отношению к заданному.
    - Параметры:
        - `root` - путь к узлу. Необязательный параметр, по умолчанию - пустая строка (т.е. корень всего дерева параметров)
    - Возвращаемое значение: массив строк - имён всех дочерних узлов.
- `get` - чтение значения в заданном узле
    - Параметры:
        - `root` - путь к узлу. Необязательный параметр, по умолчанию - пустая строка (корень всего дерева)
    - Возвращаемое значение: Если значение скалярное (число, строка, логическое), возвращается это значение; если объект (в частности, массив), то он возвращается целиком.
- `set` - запись значения в заданном узле.
    - Параметры:
        - `root` - путь к узлу. Необязательный параметр, по умолчанию - пустая строка (корень всего    дерева)
        - `value` - скалярное или объектное значение, которое надо записать. При этом на сервере изменяются только те узлы, которые есть в `value`.
        - Возвращаемое значение: отсутствует (только HTTP response code).

Входные параметры сервера визуализации
======================================

Для чтения и записи параметров `VsControllerInput` используются запросы с префиксом `vs/input`, то есть

- `/vs/input/names`
- `/vs/input/get`
- `/vs/input/set`

Ниже представлен пример дерева параметров `VsControllerInput`.

```
{
  "problemPath": "path/to/problem",     // Путь к задаче
  "timeFrame": 0,                       // Номер временного слоя
  "primaryField": "",                   // Основное поле
  "fieldMode": "Isosurface",            // Режим визуализации
  "clippingPlanes": [                   // Массив плоскостей отсечения
    {
      "pos": [1, 2, 3],                 // Положение любой точки на плоскости
      "normal": [0.1, 0, 1]             // Направление вектора нормали к плоскости
    }
  ],
  "viewportSize": [800, 600],           // Размер двумерного изображения
  "fovY": 30,                           // Вертикальный угол обзора камеры
  "renderPatience": 25,                 // Сколько миллисекунд макс. пользователю комформтно ждать между кадрами
  "renderSampleSteps": 512,             // Количество шагов на каждый луч в алгоритмах volume raycast
  "fieldParam": {
    "threshold": 0.22,                  // Пороговое значение (*1)
    "colorTransferFunction": {          // Отображение значений поля в диапазоне [0, 1] на цвета
      "0": [0, 0, 0, 1],                // Ключ = значение поля, значение = RGBA-цвет
      "1": [1, 1, 1, 1],                // ...
      "0.5": [1, 0, 0, 0]               // ...
    },
    "isosurfaceLevel": 0.5,             // Значение поля на изоповерхности (*2)
    "isosurfaceLevels": [],             // Значениея поля на изоповерхностях (*3)
    "isosurfaceOpacity": 1,             // Непрозрачность изоповерхности (*4)
    "secondaryField": ""                // Поле, значения которого изображаются на изоповерхности (*5)
  }
}
```
- `(*1)` Доступно только для режимов `MaxIntensityProjection`, `BrightnessControl`, `DensityControl`, `ColorControl`.
- `(*2)` Доступно только для режимов `Isosurface`, `ValueOnIsosurface`.
- `(*3)` Доступно только для режимов `Isosurfaces`, `ValueOnIsosurfaces`.
- `(*4)` Доступно только для режимов `Isosurface`, `Isosurfaces`, `ValueOnIsosurface`, `ValueOnIsosurfaces`.
- `(*5)` Доступно только для режимов `ValueOnIsosurface`, `ValueOnIsosurfaces`.

Отметим, что значениями в `fieldParam.colorTransferFunction` во всех случаях можно считать RGBA-цвета. Для режимов `(*4)` значение альфа, соответствующее значению поля, определяется произведением значения из `fieldParam.colorTransferFunction` и `fieldParam.isosurfaceOpacity`.

Передача состояния мыши
=======================

Состояние мыши определяется структурой `MouseState`. В ней 4 32-битных поля - координаты x, y; поворот колёсика; набор флагов. Поэтому можно использовать для передачи состояния мыши на сервер такой запрос:

```
/vs/mouse?x=12&y=34&w=1&f=0
```

Использование других методов `VsControllerInterface`
====================================================

Положение и ориентация камеры
-----------------------------

```
/vs/camera/get
```
Возвращает массив из 16 чисел - координат матрицы 4x4, описывающей положение и ориентацию камеры.
```
/vs/camera/set?m=[...]
```
Параметром передаётся массив из 16 координат (например в виде строки, которая получается
при помощи `JSON.stringify()`, применённого к массиву чисел.

Эти запросы не предполагается использовать при каждом движении мыши, так как движения мыши будут интерпретироваться сервером и при определённых условиях приводить к изменению положения и ориентации камеры.

Имена скалярных полей
---------------------
```
/vs/fields/names
```
Возвращает массив строк с именами всех скалярных полей.

```
/vs/fields/range&f=field
```
Возвращает диапазон значений поля `field`.

Информация о временной сетке
----------------------------
```
/vs/time/count
```
Возвращает число временных слоёв

```
/vs/time/frameof&t=time
```
Возвращает номер временного слоя, соответствующий значению времени `time`.
```
/vs/time/timeof&t=frame
```
Возвращает время на временном слое с номером `frame`.

Информация о имеющихся задачах
------------------------------
```
vs/problems
```
Возвращает объект с информацией о задачах
